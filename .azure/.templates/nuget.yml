parameters:
  buildConfig: $(BuildConfig)
  nugetFilter: "$(Build.ArtifactStagingDirectory)/**/*.nupkg;!$(Build.ArtifactStagingDirectory)/**/*.symbols.nupkg"
  nugetSource: $(NuGetPrivateSource)
  nugetApiKey: $(NuGetPrivateApiKey)
  solution: $(DotNetSolution)

jobs:
  - job: BuildPackPush
    continueOnError: true
    pool:
      vmImage: $(BuildImage)
    steps:
      - task: UseDotNet@2
        displayName: "Setup : .NET Core SDK"
        inputs:
          packageType: sdk
          version: 5.0.x
          includePreviewVersions: true
          installationPath: $(Agent.ToolsDirectory)/dotnet

      - script: dotnet build ${{ parameters.solution }} -c ${{ parameters.buildConfig }}
        displayName: "Build"

      - script: dotnet pack ${{ parameters.solution }} -c ${{ parameters.buildConfig }} -o $(Build.ArtifactStagingDirectory) --include-symbols --include-source
        displayName: "Pack"

      - task: DotNetCoreCLI@2
        inputs:
          command: "push"
          packagesToPush: ${{ parameters.nugetFilter }}
          nuGetFeedType: "internal"
          publishVstsFeed: $(VstsFeed)
        displayName: "Push"

      - script: dotnet nuget push --source https://pkgs.dev.azure.com/BhanuDev/377aecd9-7ece-4d91-b4a6-3c46305db51b/_packaging/a162607c-4a97-7f6f-8b58-48856f543ca9/nuget/v3/index.json --api-key VSTS ${{ parameters.nugetFilter }} --skip-duplicate

      # - script: dotnet nuget push "$(Build.ArtifactStagingDirectory)/*.nupkg" -s ${{ parameters.nugetSource }} --api-key ${{ parameters.nugetApiKey }} --skip-duplicate
      #   displayName: "Push"
